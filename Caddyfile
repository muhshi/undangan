{
    # Global options
    admin off
    auto_https off
}

:80 {
    # Logging
    log {
        output stdout
        format console
        level INFO
    }

    # Kompresi
    encode gzip zstd

    # ===========================================
    # Route 1: API requests → Backend FrankenPHP
    # ===========================================
    handle /api/* {
        reverse_proxy http://10.133.21.24:8002 {
            # Header penting untuk Laravel
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
            header_up Accept application/json
        }
    }

    # ===========================================
    # Route 2: Storage/uploads → Backend
    # ===========================================
    handle /storage/* {
        reverse_proxy http://10.133.21.24:8002 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
        }
    }

    # ===========================================
    # Route 3: Frontend (default)
    # ===========================================
    handle {
        reverse_proxy undangan-fe:8080 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
        }
    }
}